#!/bin/sh

### This script will be executed when package installed and upgraded.

HOMEBRIDGE_TZ=$(synodate --getNameInTZDB)
HOMEBRIDGE_PUID=$(id $SYNOPKG_USERNAME -u)
HOMEBRIDGE_PGID=$(id $SYNOPKG_USERNAME -g)
HOMEBRIDGE_SHARE=$(synoshare --get "$homebridge_pkgwizard_share_name" | grep Path | awk -F\[ '{print $2}' | awk -F\] '{print $1}')
HOMEBRIDGE_VOL="$HOMEBRIDGE_SHARE/homebridge-config"

echo "HOMEBRIDGE_TZ=$HOMEBRIDGE_TZ
HOMEBRIDGE_PUID=$HOMEBRIDGE_PUID
HOMEBRIDGE_PGID=$HOMEBRIDGE_PGID
HOMEBRIDGE_SHARE=$HOMEBRIDGE_SHARE
HOMEBRIDGE_VOL=$HOMEBRIDGE_VOL" > $SYNOPKG_PKGDEST/.env

mkdir "$HOMEBRIDGE_VOL"
chmod 755 "$HOMEBRIDGE_VOL"

cd $SYNOPKG_PKGDEST
docker-compose -f $SYNOPKG_PKGDEST/docker-compose.yml pull

exit 0
